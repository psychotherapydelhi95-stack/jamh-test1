<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Track Submission | JAMH</title>
  <link rel="stylesheet" href="assets/style.css" />
  <style>
    body { background:#f7fbff; }
    .track-container { max-width:820px; margin:50px auto; background:#fff; padding:36px; border-radius:10px; box-shadow:0 6px 18px rgba(9,30,66,0.08); }
    h2 { color:#004080; margin-bottom:6px; }
    p.lead { color:#333; margin-top:0; }

    .tracker { display:flex; gap:12px; margin-top:20px; }
    .tracker input { flex:1; padding:12px 14px; border-radius:8px; border:1px solid #d1dbe8; font-size:1rem; }
    .tracker button { background:#004080; color:#fff; border:none; padding:12px 18px; border-radius:8px; cursor:pointer; font-weight:600; }

    .status-card { margin-top:24px; padding:18px; border-radius:8px; border:1px solid #e6eefc; background:#fbfeff; }
    .status-entry { display:flex; justify-content:space-between; gap:16px; align-items:center; }
    .status-badge { padding:8px 12px; border-radius:20px; font-weight:700; }
    .badge-received { background:#fff4e6; color:#a65a00; border:1px solid #ffd9b3; }
    .badge-under { background:#e8f4ff; color:#055a9a; border:1px solid #bfe0ff; }
    .badge-decision { background:#eafbe9; color:#117a2d; border:1px solid #c6f0c9; }

    .note { margin-top:14px; color:#666; font-size:0.95rem; }

    /* small screen */
    @media (max-width:640px){ .tracker { flex-direction:column; } }
  </style>
</head>
<body>
  <header>
    <h1>Journal of Addiction and Mental Health</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="submission.html">Submit Paper</a>
      <a href="track.html" style="color:#ffd700;">Track Submission</a>
      <a href="#contact">Contact</a>
    </nav>
  </header>

  <main class="track-container">
    <h2>Track Your Submission</h2>
    <p class="lead">Enter the Submission ID you received in your confirmation email to see the current status of your manuscript.</p>

    <div class="tracker">
      <input id="submissionId" placeholder="Enter Submission ID (e.g. JAMH-2025-0001)" aria-label="Submission ID">
      <button id="checkBtn">Check Status</button>
    </div>

    <div class="status-card" id="statusCard" style="display:none;">
      <!-- Filled dynamically -->
    </div>

    <p class="note">If you did not receive a confirmation email, check your spam folder or contact <strong>jamheditor@gmail.com</strong>.</p>

    <hr style="margin-top:26px; border:none; border-top:1px solid #eef4ff;">

    <h3 style="margin-top:20px;">How tracking works</h3>
    <ol>
      <li>When you submit, the system emails you a unique <strong>Submission ID</strong> and stores your data in a secure Google Drive folder.</li>
      <li>Editors update the status in an internal Google Sheet (Received → Under Review → Decision).</li>
      <li>This page queries that sheet (read-only) and shows the up-to-date status.\li>
    </ol>

    <p class="note">Want this hooked up to Google Sheets automatically? I can provide the exact Google Apps Script that updates the sheet and returns JSON for this page to query (CORS-friendly).</p>
  </main>

  <footer>
    <p>© 2025 Journal of Addiction and Mental Health — Society for Addiction Psychology</p>
  </footer>

  <script>
    // Live Google Sheet endpoint
const API_URL = "https://script.google.com/macros/s/AKfycbwxVpB7515Y-XBSwCjf2mEVPltpfh-cVgzPD6bxhn_Kt8SkV_GbhDGzSVXhM92XeoyC/exec";

    };

    const checkBtn = document.getElementById('checkBtn');
    const statusCard = document.getElementById('statusCard');

    checkBtn.addEventListener("click", () => {
  const id = submissionId.value.trim();

  if (!id) {
    statusCard.style.display = "block";
    statusCard.innerHTML = "Please enter a Submission ID.";
    return;
  }

  fetch(`${API_URL}?id=${encodeURIComponent(id)}`)
    .then(r => r.json())
    .then(data => {
      statusCard.style.display = "block";

      if (data.error) {
        statusCard.innerHTML = `<strong>${id}</strong> not found.`;
        return;
      }

      statusCard.innerHTML = `
        <strong>Submission ID:</strong> ${data.SubmissionID}<br>
        <strong>Status:</strong> ${data.Status}<br>
        <strong>Last Updated:</strong> ${data.LastUpdated}<br>
        <strong>Note:</strong> ${data.Note}
      `;
    }).catch(err => {
      statusCard.innerHTML = "Error connecting to the server.";
    });
});

      }

      // Demo lookup
      const row = demoDB[id];
      if (!row) {
        statusCard.innerHTML = `
          <div class="status-entry">
            <div><strong>${id}</strong> — Not found</div>
            <div><span class="status-badge badge-received">Not found</span></div>
          </div>
          <p class="note">If you believe this is an error, email <strong>jamheditor@gmail.com</strong>.</p>
        `;
        return;
      }

      // Status badge
      let badgeClass = 'badge-received';
      if (row.status.toLowerCase().includes('under')) badgeClass = 'badge-under';
      if (row.status.toLowerCase().includes('decision')) badgeClass = 'badge-decision';

      statusCard.innerHTML = `
        <div class="status-entry">
          <div>
            <div><strong>Submission ID:</strong> ${id}</div>
            <div><strong>Status:</strong> ${row.status}</div>
            <div><strong>Last updated:</strong> ${row.date}</div>
            <div style="margin-top:8px; color:#333;"><strong>Note:</strong> ${row.note}</div>
          </div>
          <div><span class="status-badge ${badgeClass}">${row.status}</span></div>
        </div>
      `;
    });

    // ENTER key support
    document.getElementById('submissionId').addEventListener('keypress', function(e){ if (e.key === 'Enter') checkBtn.click(); });
  </script>
</body>
</html>